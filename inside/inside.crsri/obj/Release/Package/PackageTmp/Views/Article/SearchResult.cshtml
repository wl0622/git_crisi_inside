@{
    ViewBag.Title = "SearchResult";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@Html.Action("GetTitleStyle", "DisplayLayout", new { name = "长江科学院-搜索结果" })
@model List<crsri.cn.Model.t_web_article_model>
<script type="text/javascript">
    function goPage() {

        var inputDigit = $(".fanye").find(":input").val();
        let reg = /^\d/;
        if (reg.test(inputDigit)) {

            var url = window.location.href;
            var lastnum = url.substring(url.lastIndexOf("/") + 1);
            var goUrl = lastnum.length == 6 ? url + "/1" : url.substring(0, url.lastIndexOf("/")) + "/" + inputDigit;
            console.log(goUrl);
            window.location.href = goUrl;
        }
    }
</script>
<style type="text/css">
    body {
        background: url("/images/sub/banner.png") no-repeat 0 0,url(/images/sub/subbg.jpg);
    }
</style>
<div class="subbg">
    <span class="sublogo"></span>
</div>
<div class="contentbox sub_cnt">

    <!-- 当前位置 -->
    <div class="siteNav bdb_d fix showbg">
        <div class="l fix zy_cur mb-10">
            <div class="l tit mt-10 pl-10"><img src="/images/icon_location.png"><b class="dib vm">当前位置：</b></div>
            <p class="l mt-10"><a href="/Home/index">首页</a><span>全站检索结果</span></p>
        </div>
    </div>

    <!-- 子页内容框 -->
    <div class="zy_contentbox">
        <!-- 右边内容 -->
        <div class="zy_ful_con">
            <!-- 当前位置 -->
            <div class="zy_title fix">
                <span>关键字 “@ViewBag.keyWords” 共检索到 @ViewBag.totalCount 条记录</span> 
            </div>
            <!-- 内容展示块-->
            <div class="news_list zy_listbox">

                <ul>
                    @{
                        foreach (crsri.cn.Model.t_web_article_model m in Model)
                        {
                            <li><b>·</b><a href="/Article/index/@inside.crsri.Utility.helper.UrlEncry(@m.articleID)">@Html.Raw(@System.Web.HttpUtility.HtmlDecode(@m.title).Replace(@ViewBag.keyWords, "<label style='color:red'>" + @ViewBag.keyWords + "</label>"))</a><span>[@Convert.ToDateTime(@m.releaseTime).ToString("yyyy-MM-dd").Substring(5)]</span></li>
                        }
                    }
                </ul>

                <div class="fanye" style="text-align: left;">
                    @{
                        int pageSize = 15;
                        int totalCount = Convert.ToInt32(ViewBag.totalCount);
                        int maxPage = totalCount % pageSize == 0 ? totalCount / pageSize : totalCount / pageSize + 1;

                        if (maxPage > 1)
                        {
                            int curPage = Convert.ToInt32(ViewBag.currentPage);
                            int showPage = maxPage < 3 ? maxPage : 3;
                            List<int> txtPageNum = new List<int>();
                            if (maxPage <= showPage)
                            {
                                for (int i = 1; i <= maxPage; i++)
                                {
                                    txtPageNum.Add(i);
                                }
                            }
                            else
                            {
                                int startNum = curPage > 2 ? curPage - 2 : 1;

                                for (int i = startNum; i <= startNum + 2; i++)
                                {
                                    txtPageNum.Add(i);
                                }


                            }

                            int prePage = curPage - 1;
                            int nextPage = curPage + 1;
                            int hidePage = txtPageNum.Last() + 1;

                            string htmlPre = string.Format("<a href='/Article/SearchResult/{0}/{1}'>上一页</a>", @ViewBag.keyWords, prePage == 0 ? 1 : prePage);
                            string htmlNext = string.Format("<a href='/Article/SearchResult/{0}/{1}'>下一页</a>",@ViewBag.keyWords, nextPage > maxPage ? maxPage : nextPage);
                            string htmlInfo = string.Format("<span>共{0}页</span>", maxPage);
                            string htmlGo = string.Format("<span>转到第<input type='text'>页</span><a href='javascript:goPage();' class='ok'>确定</a></div>");

                            @Html.Raw(htmlPre);
                        <div id="pages">
                            @foreach (int num in txtPageNum)
                            {
                                if (num == curPage)
                                {
                                    @Html.Raw(string.Format("<a href='/Article/SearchResult/{0}/{1}' class='current'>{1}</a>", @ViewBag.keyWords, num));
                                }
                                else
                                {
                                    @Html.Raw(string.Format("<a href='/Article/SearchResult/{0}/{1}'>{1}</a>", @ViewBag.keyWords, num));
                                }
                            }
                            <a href="/Article/SearchResult/@ViewBag.keyWords/@hidePage">...</a>
                            <a href="/Article/SearchResult/@ViewBag.keyWords/@maxPage">@maxPage</a>
                        </div>
                        @Html.Raw(htmlNext)
                        <p>
                            @Html.Raw(htmlGo)
                        </p>
                        }

                    }

                </div>

                <!-- 通用分页end -->
            </div>
        </div>

    </div>
    <div class="clearfix" style="clear:both;"></div>
</div>

