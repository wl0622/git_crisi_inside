@{
    ViewBag.Title = "list";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@Html.Action("GetTitleStyle", "DisplayLayout", new { name = "长江科学院内网-" + @System.Web.HttpUtility.HtmlDecode(@ViewBag.subjectName) })
@model List<crsri.cn.Model.t_web_article_model>
<style type="text/css">
    body {
        background: url("/images/sub/banner.png") no-repeat 0 0,url(/images/sub/subbg.jpg);
    }
</style>
<script type="text/javascript">
    function goPage() {

        var inputDigit = $(".fanye").find(":input").val();
        let reg = /^\d/;
        if (reg.test(inputDigit)) {

            var url = window.location.href;
            var lastnum = url.substring(url.lastIndexOf("/") + 1);
            var goUrl = lastnum.length == 6 ? url + "/1" : url.substring(0, url.lastIndexOf("/")) + "/" + inputDigit;
            console.log(goUrl);
            window.location.href = goUrl;
        }
    }
</script>
<div class="subbg">
    <span class="sublogo"></span>
</div>
<div class="contentbox sub_cnt">
    <div class="sub_left_banner sub_article_bg">
        <div class="siteNav  fix ">
            <div class="l fix zy_cur" style="margin-left:230px;">
                <div class="l tit mt-10"><img src="/images/icon_location.png"><b class="dib vm">当前位置：</b></div>
                <p class="l mt-10"><a href="/Home/index">首页</a><a><span>@ViewBag.subjectName</span></a></p>
            </div>
        </div>
    </div>
    <div style="height: 1386px; border-right: 1px solid #79b6ff; border-bottom: 1px solid #79b6ff">
        <div class="zy_left_con">
            <div class="sub_left_list">
                <h2 class="tit">新闻中心</h2>
                <ul>
                    @{

                        var subjects = ViewBag.SubjectItems as List<crsri.cn.Model.t_web_subject_model>;
                        foreach (crsri.cn.Model.t_web_subject_model s in subjects)
                        {
                            if (@s.subjectName == @ViewBag.subjectName)
                            {
                                <li class="cur"> <a href="/Article/list/@s.subjectID">@s.subjectName</a></li>
                            }
                            else
                            {
                                <li><a href="/Article/list/@s.subjectID">@s.subjectName</a></li>
                            }
                        }
                    }
                </ul>
            </div>

            <!--统计 -->
            <div class="tg_cnt">
                <div class="tg_head">
                    年度原创稿统计
                </div>
                <div class="tg_list">
                    <ul>
                        <li>投稿单位</li>
                        <li>数量</li>
                    </ul>
                    @{
                        List<inside.crsri.Models.statisticsModel> statistics = ViewBag.statistics as List<inside.crsri.Models.statisticsModel>;
                        foreach (inside.crsri.Models.statisticsModel m in statistics)
                        {
                            <ul>
                                <li>@m.dep</li>
                                <li>@m.cnt</li>
                            </ul>
                        }
                    }


                </div>
            </div>
        </div>
        <!-- 右边内容 -->
        <div class="zy_right_con">

            <!-- 当前位置 -->
            <div class="zy_title fix">
                <h2>@ViewBag.subjectName<i></i></h2>
            </div>
            <!-- 内容展示块-->
            <div class="news_list zy_listbox">

                <ul>
                    @{
                        foreach (crsri.cn.Model.t_web_article_model m in Model)
                        {
                            <li><b>·</b><a href="/Article/index/@inside.crsri.Utility.helper.UrlEncry(@m.articleID)" target="_blank">@System.Web.HttpUtility.HtmlDecode(@m.title)</a>
                    <span>@Convert.ToDateTime(@m.releaseTime).ToString("yyyy-MM-dd").Substring(5)</span></li>
                        }
                    }
                </ul>

                <div class="fanye" style="text-align: left;margin-left:20px;">
                    @{
                        int pageSize = 15;
                        int totalCount = Convert.ToInt32(ViewBag.totalCount);
                        int maxPage = totalCount % pageSize == 0 ? totalCount / pageSize : totalCount / pageSize + 1;

                        if (maxPage > 1)
                        {
                            int curPage = Convert.ToInt32(ViewBag.currentPage);
                            int showPage = maxPage < 3 ? maxPage : 3;
                            List<int> txtPageNum = new List<int>();
                            if (maxPage <= showPage)
                            {
                                for (int i = 1; i <= maxPage; i++)
                                {
                                    txtPageNum.Add(i);
                                }
                            }
                            else
                            {
                                int startNum = curPage > 2 ? curPage - 2 : 1;

                                for (int i = startNum; i <= startNum + 2; i++)
                                {
                                    txtPageNum.Add(i);
                                }


                            }

                            int prePage = curPage - 1;
                            int nextPage = curPage + 1;
                            int hidePage = txtPageNum.Last() + 1;

                            string htmlPre = string.Format("<a href='/Article/list/{0}/{1}'>上一页</a>", Model.First().subjectID, prePage == 0 ? 1 : prePage);
                            string htmlNext = string.Format("<a href='/Article/List/{0}/{1}'>下一页</a>", Model.First().subjectID, nextPage > maxPage ? maxPage : nextPage);
                            string htmlInfo = string.Format("<span>共{0}页</span>", maxPage);
                            string htmlGo = string.Format("<span>转到第<input type='text'>页</span><a href='javascript:goPage();' class='ok'>确定</a>");

                            @Html.Raw(htmlPre);
                        <div id="pages">
                            @foreach (int num in txtPageNum)
                            {
                                if (num == curPage)
                                {
                                    @Html.Raw(string.Format("<a href='/Article/list/{0}/{1}' class='current'>{1}</a>", Model.First().subjectID, num));
                                }
                                else
                                {
                                    @Html.Raw(string.Format("<a href='/Article/list/{0}/{1}'>{1}</a>", Model.First().subjectID, num));
                                }
                            }
                            <a href="/Article/List/@Model.First().subjectID/@hidePage">...</a>
                            <a href="/Article/List/@Model.First().subjectID/@maxPage">@maxPage</a>
                        </div>
                        @Html.Raw(htmlNext);
                        <p>
                            @Html.Raw(htmlGo)
                        </p>
                        }

                    }

                </div>
                <!-- 通用分页end -->
            </div>
        </div>


    </div>




</div>
